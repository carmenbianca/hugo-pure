{{- $pctx := . -}}
{{- $pages := slice -}}

{{- if $.IsHome -}}
    {{- $pages = .Site.RegularPages -}}
    {{- $pages = where $pages "Section" "!=" "v" -}}
    {{- $pages = where $pages "Type" "!=" "search" -}}
    {{- if ne hugo.Environment "demo" }}
    {{- $pages = where $pages "Section" "!=" "demo" -}}
    {{- end }}
{{- else -}}
    {{- $pages = $pctx.Pages -}}
{{- end -}}

{{- /* $pages = $pages.ByPublishDate.Reverse */ -}}
{{- $limit := .Site.Config.Services.RSS.Limit -}}
{{- if ge $limit 1 -}}
    {{- $pages = $pages | first $limit -}}
{{- end -}}

{{- $pageSize := $pctx.Params.paginate }}
{{- if $pageSize }}
    {{- $pages = (.Paginate $pages $pageSize).Pages }}
{{- else }}
    {{- $pages = (.Paginate $pages).Pages }}
{{- end }}

{{- $columnClass := "" }}
{{- if or $pctx.Params.doubleColumns .Site.Params.doubleColumns }}
{{- $columnClass = "double-columns" }}
{{- end }}
<div class="pure-g post-list {{ $columnClass -}}">
    {{- range $pages }}
        <article class="pure-u-1 post-card">
            {{- $page := . }}
            {{- $poster := .Resources.Get "poster.webp" }}

            {{- if $poster }}
                <a href="{{- .RelPermalink -}}">
                    <figure class="poster poster-mask">
                        <img src="{{- $poster.RelPermalink -}}">
                        {{- if false }}
                            <i class="source-icon fa-solid fa-arrow-up-right-from-square"></i>
                        {{- end }}
                    </figure>
                </a>
            {{- end }}

            <div class="post-card__content">
                <div class="post-title">
                    <a href="{{- .RelPermalink -}}">
                        <h1>
                            {{- partial "draft-mark" . }}
                            {{ .Title -}}
                        </h1>
                    </a>
                </div>

                {{- partial "post-meta" . }}

                {{- if .Params.showSummary }}
                    <div class="post-content">{{- .Summary }}</div>
                    {{- if .Truncated }}
                        <p class="post-meta">...</p>
                    {{- end }}
                {{- end }}
            </div>
        </article>
    {{- end }}
</div>

{{- if gt .Paginator.TotalPages 1 }}
<div class="pagination-wrapper">
    {{- partial "pagination.html" . }}
</div>
{{- end }}
